name: GitHub Actions Demo
run-name: ${{ github.actor }} is running addressbook tests
on: workflow_dispatch
jobs:
  Run-Squish-Addressbook-Tests:
    runs-on: self-hosted
    steps:
      - name: Checkout repository
        uses: actions/checkout@v1

      - name: Run addressbook tests
        run: C:\Squish_for_Qt_6.7.2\bin\squishrunner.exe --testsuite suite_captures --testcase tst_captures_tests_in_BDD --local --exitCodeOnFail 13 --reportgen junit,reports/xml/junit_report.xml --reportgen html,reports/web_report
        shell: cmd
         
      - name: Publish Test Report
        uses: mikepenz/action-junit-report@v3
        if: success() || failure()
        with:
          report_paths: '**/reports/xml/*.xml'
    
      - name: Test results
        if: success() || failure()
        uses: actions/upload-artifact@v2
        with:
          name: Test reports
          path: |
            ${{ github.workspace }}/reports/
            
      - name: Deploy static content to Pages
        on:
            # Runs on pushes targeting the default branch
            push:
              branches: ["master"]
          
            # Allows you to run this workflow manually from the Actions tab
            workflow_dispatch:
          
          # Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
        permissions:
            contents: read
            pages: write
            id-token: write
          
          # Allow one concurrent deployment
        concurrency:
            group: "pages"
            cancel-in-progress: true
             - jobs:
                    deploy:
                      environment:
                        name: github-pages
                        url: ${{ steps.deployment.outputs.page_url }}
                      runs-on: ubuntu-latest
                      steps:
                        - name: Checkout
                          uses: actions/checkout@v4
                        - name: Setup Pages
                          uses: actions/configure-pages@v5
                        - name: Upload artifact
                          uses: actions/upload-pages-artifact@v3
                          with:
                            # Upload entire repository
                            path: './reports/web_report'
                        - name: Deploy to GitHub Pages
                          id: deployment
                          uses: actions/deploy-pages@v4
